# 数据获取与处理指南
——基于《基于因果森林的数据要素赋能对企业全要素生产率的异质性影响研究》

本文档旨在指导如何获取和整理硕士论文所需的数据。根据您的题目和参考论文，数据主要分为两大部分：**结构化财务数据**（用于计算 TFP 和控制变量）和**非结构化文本数据**（用于构建“数据要素赋能”核心自变量）。

## 1. 数据来源概览

| 数据类型 | 推荐来源 | 备选来源 | 用途 |
| :--- | :--- | :--- | :--- |
| **财务数据** | **CSMAR (国泰安)** | Wind (万得), RESSET (锐思) | 计算全要素生产率 (TFP)、控制变量 (Size, Lev, etc.) |
| **文本数据** | **CNRDS (中国研究数据服务平台)** | CSMAR 文本数据库, 巨潮资讯网 (爬虫) | 提取 MD&A 文本，构建“数据要素赋能”指标 |
| **宏观数据** | 国家统计局 / CSMAR | 各省市统计年鉴 | 控制地区经济水平 (GDP) 等 |

---

## 2. 财务数据获取 (CSMAR)

请登录 CSMAR 数据库，找到 **“股票市场系列”** 和 **“公司研究系列”**，下载 **2011-2023年**（建议多下载几年以便计算滞后项）的 A 股上市公司数据。

### 2.1 全要素生产率 (TFP) 所需字段
计算 TFP（通常使用 LP 法或 OP 法）需要以下核心变量：

| 变量名 | 对应会计科目/指标 | CSMAR 表格位置 |
| :--- | :--- | :--- |
| **产出 (Y)** | 营业收入 | 利润表 |
| **资本投入 (K)** | 固定资产净额 | 资产负债表 |
| **劳动投入 (L)** | 员工人数 | 公司治理/治理结构/员工情况 |
| **中间投入 (M)** | 购买商品、接受劳务支付的现金 | 现金流量表 |

> **提示**：如果使用 OP 法，还需要“投资 (Investment)”数据，通常用“购建固定资产、无形资产和其他长期资产支付的现金”代理。

### 2.2 控制变量所需字段
参考论文中使用的控制变量及其计算所需字段：

| 变量代码 | 变量含义 | 计算公式/来源 | 所需字段 |
| :--- | :--- | :--- | :--- |
| **Size** | 企业规模 | ln(总资产) | 资产负债表-资产总计 |
| **Lev** | 资产负债率 | 总负债 / 总资产 | 资产负债表-负债合计 |
| **Age** | 上市年限 | ln(当年年份 - 上市年份 + 1) | 公司基本信息表-上市日期 |
| **SOE** | 产权性质 | 国有=1，非国有=0 | 公司治理-股权性质/实际控制人 |
| **ROA** | 总资产收益率 | 净利润 / 总资产 | 利润表-净利润 |
| **TobinQ** | 托宾Q值 | 市值 / 重置成本 | 相对价值指标表 (CSMAR直接有) |
| **Board** | 董事会规模 | ln(董事人数) | 公司治理-董事会特征 |
| **Top1** | 股权集中度 | 第一大股东持股比例 | 公司治理-股权结构 |

---

## 3. 文本数据获取与指标构建 (CNRDS/CSMAR)

这是论文的核心创新点。你需要获取上市公司年报中的 **“管理层讨论与分析” (MD&A)** 内容。

### 3.1 获取步骤
1.  **下载文本**：
    *   若学校有 **CNRDS** 权限：直接进入“文本挖掘”模块，下载处理好的 MD&A 文本或分词结果。
    *   若只有 **CSMAR** 权限：进入“文本数据库” -> “年报文本” -> “管理层讨论与分析”，下载 Excel/Txt 格式。
2.  **构建“数据要素”词典**：
    *   在参考论文的“数字化转型”词典基础上，**必须增加**强调“数据要素”的词汇，以贴合你的题目。建议词典如下：

    **基础数字化词汇 (参考论文)**：
    > 大数据、云计算、人工智能、区块链、物联网、数字技术、数字经济、智能制造、互联网+、信息技术、电子商务、平台经济

    **数据要素特有词汇 (建议新增)**：
    > **数据要素、数据资产、数据资源、数据挖掘、数据治理、数据共享、数据交易、数据安全、数据驱动、首席数据官、CDO、数据中台、数据湖、数据清洗、数据赋能**

### 3.2 指标计算
使用 Python (`jieba` 库) 对每家公司的 MD&A 文本进行分词，统计上述**关键词出现的总频次**。
*   `Data_Score` = ln(关键词总频次 + 1)

---

## 4. 数据处理流程 (建议)

### 步骤一：清洗财务数据
1.  **剔除异常样本**：
    *   剔除金融行业 (行业代码 J)。
    *   剔除 ST、*ST、PT 公司。
    *   剔除资不抵债 (资产 < 负债) 的样本。
    *   剔除关键变量缺失的样本。
2.  **缩尾处理 (Winsorize)**：
    *   对连续变量 (Size, Lev, ROA, TFP 等) 进行 1% 和 99% 分位数的缩尾处理，防止极端值干扰。

### 步骤二：测算 TFP
1.  使用 Stata (`prodest` 或 `opreg` 命令) 或 Python (`semipy` 库) 计算 TFP_LP 或 TFP_OP。
2.  保存为 `TFP_result.dta` 或 `TFP_result.csv`。

### 步骤三：合并数据
1.  以 **股票代码 (Stkcd)** 和 **年份 (Year)** 为主键 (Key)。
2.  将 `财务数据`、`TFP数据`、`文本指标数据` 进行 Merge。

---

## 5. 因果森林分析准备
因果森林模型需要的数据格式通常为：
*   **Y (因变量)**: TFP (全要素生产率)
*   **W (处理变量)**: 数据要素赋能指标 (可以是 0/1 虚拟变量，也可以是连续变量，因果森林通常处理 0/1 较多，如果是连续变量需考虑 Generalized Random Forest)
    *   *注：参考论文将词频指标转换为了 0/1 变量（是否有相关讨论），你也可以尝试保留连续变量或按中位数分组。*
*   **X (协变量/特征变量)**: Size, Lev, Age, SOE, Industry, Year, Location 等 (用于捕捉异质性)。

---

## 6. 工具准备
*   **数据下载**: 浏览器 (Chrome/Edge)
*   **数据清洗**: Python (Pandas) 或 Stata
*   **TFP 计算**: Stata (推荐，命令成熟) 或 Python
*   **因果森林**: Python (`econml`, `causalml`) 或 R (`grf`) —— **这是核心分析工具**
